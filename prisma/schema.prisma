// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Link {
  id          Int      @id @default(autoincrement())
  title       String
  url         String
  description String?
  category    String   @default("General")
  isRecommended Boolean @default(false)
  createdAt   DateTime @default(now())
}

model Category {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  sortOrder Int      @default(0) // 数字越小排越前，或者反过来，我们定为：数字越大排越前
}

model GlobalConfig {
  id    Int    @id @default(autoincrement())
  key   String @unique // 例如: "announcement"
  value String // 存储公告内容
}

model SmartWallpaper {
  id        Int      @id @default(autoincrement())
  name      String   @unique // 主题名称，如 "默认风景", "二次元", "极简"
  morning   String   // 存 JSON 字符串或用逗号分隔的 URL
  afternoon String
  night     String
  createdAt DateTime @default(now())
}

// 公告历史记录表
model AnnouncementHistory {
  id        Int      @id @default(autoincrement())
  content   String   // 历史内容
  createdAt DateTime @default(now()) // 存档时间
}

// 博客文章模型
model Post {
  id        Int      @id @default(autoincrement())
  title     String
  content   String
  summary   String?
  published Boolean  @default(false)
  isMarkdown Boolean @default(true)
  
  // ✨✨✨ 新增：外观设置 ✨✨✨
  backgroundImage  String?  // 背景图链接 (空则使用默认深色背景)
  contentBgColor   String   @default("#0f172a") // 文字板背景色 (默认深蓝)
  contentBgOpacity Float    @default(0.8)       // 文字板不透明度 (0.0 - 1.0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 便利贴模型
model Note {
  id        Int      @id @default(autoincrement())
  content   String
  color     String   @default("yellow")
  sortOrder Int      @default(0) // 保留，可用作 Z轴层级 (z-index)
  x         Int      @default(100) // ✨ 新增：X坐标 (像素)
  y         Int      @default(200) // ✨ 新增：Y坐标 (像素)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// AI 角色模型
model AICharacter {
  id          Int      @id @default(autoincrement())
  name        String
  avatar      String?
  description String?
  systemPrompt String
  
  isPublic    Boolean  @default(false) // ✨✨✨ 新增：是否公开
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  sessions    AIChatSession[] @relation("SessionParticipants")
  messages    AIChatMessage[]
}

// AI 群聊会话
model AIChatSession {
  id          Int      @id @default(autoincrement())
  name        String   // 群聊名称
  
  // 参与者 (多对多)
  participants AICharacter[] @relation("SessionParticipants")
  
  messages    AIChatMessage[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// 聊天消息
model AIChatMessage {
  id          Int      @id @default(autoincrement())
  content     String
  role        String   // "user" | "assistant" | "system"
  
  // 如果是 AI 发言，关联具体的角色 ID；如果是用户，则为空
  characterId Int?
  character   AICharacter? @relation(fields: [characterId], references: [id], onDelete: Cascade)

  sessionId   Int
  session     AIChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
}